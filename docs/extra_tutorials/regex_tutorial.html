<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Python Group">

<title>Extra Tutorial: Regular Expressions in Python – Intro to Python Workshops</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Intro to Python Workshops</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-sessions" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Sessions</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-sessions">    
        <li>
    <a class="dropdown-item" href="../sessions.html">
 <span class="dropdown-text">All Sessions</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../session1/session1.html">
 <span class="dropdown-text">Session 1: Get Started with Python</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../session2a/session2.html">
 <span class="dropdown-text">Session 2a: Intro to Python Data Structures</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../session2b/session2_2.html">
 <span class="dropdown-text">Session 2b: Intro to Pandas</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../session3/session3.html">
 <span class="dropdown-text">Session 3: Logistic Regression Demo</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../extra_tutorials/regex_tutorial.html">
 <span class="dropdown-text">Extras: Regex Tutorial</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="https://github.mskcc.org/Python-Workshop/Python-Workshop.github.io/discussions"> 
<span class="menu-text">Discussion</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-links" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Links</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-links">    
        <li>
    <a class="dropdown-item" href="../link.html">
 <span class="dropdown-text">All Links</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://www.anaconda.com/download/success">
 <span class="dropdown-text">Install Anaconda</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.mskcc.org/Python-Workshop/Python-Workshop.github.io/tree/main/FollowAlong">
 <span class="dropdown-text">Follow Along Files</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../FAQ.html"> 
<span class="menu-text">FAQ</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#optional-create-a-summary-table-using-tableone" id="toc-optional-create-a-summary-table-using-tableone" class="nav-link active" data-scroll-target="#optional-create-a-summary-table-using-tableone">Optional: Create a summary table using TableOne</a></li>
  <li><a href="#filtering-rows-with-matching-patterns-using-re.search" id="toc-filtering-rows-with-matching-patterns-using-re.search" class="nav-link" data-scroll-target="#filtering-rows-with-matching-patterns-using-re.search">1. Filtering Rows with Matching Patterns using re.search()</a></li>
  <li><a href="#substituting-values-using-re.sub" id="toc-substituting-values-using-re.sub" class="nav-link" data-scroll-target="#substituting-values-using-re.sub">2. Substituting Values using re.sub()</a></li>
  <li><a href="#extracting-words-with-re.findall" id="toc-extracting-words-with-re.findall" class="nav-link" data-scroll-target="#extracting-words-with-re.findall">3. Extracting words with re.findall()</a>
  <ul class="collapse">
  <li><a href="#we-can-also-use-expressions-like-this-in-our-grep-function" id="toc-we-can-also-use-expressions-like-this-in-our-grep-function" class="nav-link" data-scroll-target="#we-can-also-use-expressions-like-this-in-our-grep-function">We can also use expressions like this in our grep function</a></li>
  </ul></li>
  <li><a href="#splitting-strings-with-re.split" id="toc-splitting-strings-with-re.split" class="nav-link" data-scroll-target="#splitting-strings-with-re.split">4. Splitting Strings with re.split()</a></li>
  <li><a href="#add-optional-flags-to-ignore-case" id="toc-add-optional-flags-to-ignore-case" class="nav-link" data-scroll-target="#add-optional-flags-to-ignore-case">5. Add Optional Flags To Ignore Case</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Extra Tutorial: Regular Expressions in Python</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Python Group </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<hr style="border: none; border-top: 2px solid #007bff; width: 100%;">
<div id="994ac3a7" class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1"></a><span class="im">import</span> re</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="im">from</span> tableone <span class="im">import</span> TableOne</span>
<span id="cb1-6"><a href="#cb1-6"></a></span>
<span id="cb1-7"><a href="#cb1-7"></a></span>
<span id="cb1-8"><a href="#cb1-8"></a>mpg <span class="op">=</span> sns.load_dataset(<span class="st">"mpg"</span>)</span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="bu">print</span>(mpg.head())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    mpg  cylinders  displacement  horsepower  weight  acceleration  \
0  18.0          8         307.0       130.0    3504          12.0   
1  15.0          8         350.0       165.0    3693          11.5   
2  18.0          8         318.0       150.0    3436          11.0   
3  16.0          8         304.0       150.0    3433          12.0   
4  17.0          8         302.0       140.0    3449          10.5   

   model_year origin                       name  
0          70    usa  chevrolet chevelle malibu  
1          70    usa          buick skylark 320  
2          70    usa         plymouth satellite  
3          70    usa              amc rebel sst  
4          70    usa                ford torino  </code></pre>
</div>
</div>
<div id="0938ae2e" class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1"></a>mpg.info()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 398 entries, 0 to 397
Data columns (total 9 columns):
 #   Column        Non-Null Count  Dtype  
---  ------        --------------  -----  
 0   mpg           398 non-null    float64
 1   cylinders     398 non-null    int64  
 2   displacement  398 non-null    float64
 3   horsepower    392 non-null    float64
 4   weight        398 non-null    int64  
 5   acceleration  398 non-null    float64
 6   model_year    398 non-null    int64  
 7   origin        398 non-null    object 
 8   name          398 non-null    object 
dtypes: float64(4), int64(3), object(2)
memory usage: 28.1+ KB</code></pre>
</div>
</div>
<section id="optional-create-a-summary-table-using-tableone" class="level3">
<h3 class="anchored" data-anchor-id="optional-create-a-summary-table-using-tableone">Optional: Create a summary table using TableOne</h3>
<p>To get a better idea of our dataset, we can create a summary table using the ‘tableone’ package.</p>
<div id="7764009f" class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1"></a>continuous <span class="op">=</span> [<span class="st">"mpg"</span>, <span class="st">"displacement"</span>, <span class="st">"horsepower"</span>, <span class="st">"weight"</span>, <span class="st">"acceleration"</span>, <span class="st">"model_year"</span>]</span>
<span id="cb5-2"><a href="#cb5-2"></a>categorical <span class="op">=</span> [<span class="st">"origin"</span>, <span class="st">"cylinders"</span>]</span>
<span id="cb5-3"><a href="#cb5-3"></a></span>
<span id="cb5-4"><a href="#cb5-4"></a><span class="bu">print</span>(<span class="st">"Continuous:"</span>, continuous, <span class="st">"</span><span class="ch">\n</span><span class="st">Categorical:"</span>, categorical, <span class="st">"</span><span class="ch">\n\n</span><span class="st">"</span>)</span>
<span id="cb5-5"><a href="#cb5-5"></a></span>
<span id="cb5-6"><a href="#cb5-6"></a>table <span class="op">=</span> TableOne(data<span class="op">=</span>mpg, categorical<span class="op">=</span>categorical, continuous<span class="op">=</span>continuous, label_suffix<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb5-7"><a href="#cb5-7"></a><span class="bu">print</span>(<span class="st">"MPG Summary:</span><span class="ch">\n</span><span class="st">"</span>, table)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Continuous: ['mpg', 'displacement', 'horsepower', 'weight', 'acceleration', 'model_year'] 
Categorical: ['origin', 'cylinders'] 


MPG Summary:
                                Missing         Overall
n                                                  398
mpg, mean (SD)                       0      23.5 (7.8)
cylinders, n (%)        3                      4 (1.0)
                        4                   204 (51.3)
                        5                      3 (0.8)
                        6                    84 (21.1)
                        8                   103 (25.9)
displacement, mean (SD)              0   193.4 (104.3)
horsepower, mean (SD)                6    104.5 (38.5)
weight, mean (SD)                    0  2970.4 (846.8)
acceleration, mean (SD)              0      15.6 (2.8)
model_year, mean (SD)                0      76.0 (3.7)
origin, n (%)           europe               70 (17.6)
                        japan                79 (19.8)
                        usa                 249 (62.6)
</code></pre>
</div>
</div>
From the above summary table, we can see that we have both continuous and categorial variables, as well as some missing data.
<hr style="border: none; border-top: 1px solid #f8f9fa; max-width: 950px;">
</section>
<section id="filtering-rows-with-matching-patterns-using-re.search" class="level2">
<h2 class="anchored" data-anchor-id="filtering-rows-with-matching-patterns-using-re.search">1. Filtering Rows with Matching Patterns using re.search()</h2>
<section id="get-list-of-cars-with-make-ford" class="level4">
<h4 class="anchored" data-anchor-id="get-list-of-cars-with-make-ford">Get list of cars with make ‘ford’</h4>
<p>If we want to get a list of the cars with make ‘ford’ (equivalent to grep(“ford”, mpg$name)):</p>
<p>We can use mpg.loc[] plus a filter to select all names containing ‘ford’.</p>
<p>We create the filter using mpg[‘name’].apply() and a lambda function.</p>
<div id="51c6da17" class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1"></a>mpg.loc[mpg[<span class="st">'name'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: re.search(<span class="st">"ford"</span>, x) <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>), </span>
<span id="cb7-2"><a href="#cb7-2"></a>        <span class="st">'name'</span>][<span class="dv">1</span>:<span class="dv">10</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="4">
<pre><code>5             ford galaxie 500
17               ford maverick
25                   ford f250
32                  ford pinto
36             ford torino 500
40            ford galaxie 500
43    ford country squire (sw)
48                ford mustang
61         ford pinto runabout
Name: name, dtype: object</code></pre>
</div>
</div>
</section>
<section id="or" class="level4">
<h4 class="anchored" data-anchor-id="or">OR</h4>
<p>We can define our own grep function and use that!</p>
<p>There is a file called ‘greppy.py’ in the downloadables folder on github. You can import that to get an r-like grep function. The function details are also included below.</p>
<div id="fd860440" class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1"></a><span class="kw">def</span> grep(pattern, text, values<span class="op">=</span><span class="va">False</span>, ignore_case<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb9-2"><a href="#cb9-2"></a>    <span class="co"># Compile the regex pattern with the ignore_case flag if enabled</span></span>
<span id="cb9-3"><a href="#cb9-3"></a>    flags <span class="op">=</span> re.IGNORECASE <span class="cf">if</span> ignore_case <span class="cf">else</span> <span class="dv">0</span></span>
<span id="cb9-4"><a href="#cb9-4"></a>    regex <span class="op">=</span> re.<span class="bu">compile</span>(pattern, flags)</span>
<span id="cb9-5"><a href="#cb9-5"></a></span>
<span id="cb9-6"><a href="#cb9-6"></a>    <span class="cf">if</span> values:</span>
<span id="cb9-7"><a href="#cb9-7"></a>        <span class="co"># Return the matching lines</span></span>
<span id="cb9-8"><a href="#cb9-8"></a>        <span class="cf">return</span> [line <span class="cf">for</span> line <span class="kw">in</span> text <span class="cf">if</span> regex.search(line)]</span>
<span id="cb9-9"><a href="#cb9-9"></a>    <span class="cf">else</span>:</span>
<span id="cb9-10"><a href="#cb9-10"></a>        <span class="co"># Return a list of booleans indicating matches</span></span>
<span id="cb9-11"><a href="#cb9-11"></a>        <span class="cf">return</span> [<span class="bu">bool</span>(regex.search(line)) <span class="cf">for</span> line <span class="kw">in</span> text]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="9384041d" class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1"></a><span class="co">## or, if you put 'greppy.py' from the 'Downloadable' folder in your working directory</span></span>
<span id="cb10-2"><a href="#cb10-2"></a><span class="im">from</span> greppy <span class="im">import</span> grep</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You can also install greppy from github via:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode numberSource {bash} number-lines code-with-copy"><code class="sourceCode"><span id="cb11-1"><a href="#cb11-1"></a>pip install git+https://github.com/daniv-20/greppy.git</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div id="fdc2ca3b" class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1"></a>matches <span class="op">=</span> grep(<span class="st">"ford"</span>, mpg[<span class="st">'name'</span>], values <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb12-2"><a href="#cb12-2"></a><span class="bu">print</span>(matches[<span class="dv">1</span>:<span class="dv">10</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>['ford galaxie 500', 'ford maverick', 'ford f250', 'ford pinto', 'ford torino 500', 'ford galaxie 500', 'ford country squire (sw)', 'ford mustang', 'ford pinto runabout']</code></pre>
</div>
</div>
<hr style="border: none; border-top: 1px solid #f8f9fa; max-width: 950px;">
</section>
<section id="filter-rows-by-pattern" class="level4">
<h4 class="anchored" data-anchor-id="filter-rows-by-pattern">Filter Rows by Pattern</h4>
<p>If we wanted to look for the mpg information on all cars of make ‘ford’, we can filter for rows where the ‘name’ contains ‘ford’</p>
<div id="e25bfbba" class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1"></a>filtered_rows <span class="op">=</span> mpg[mpg[<span class="st">'name'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="bu">bool</span>(re.search(<span class="st">'ford'</span>, x)))]</span>
<span id="cb14-2"><a href="#cb14-2"></a><span class="bu">print</span>(filtered_rows.head())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     mpg  cylinders  displacement  horsepower  weight  acceleration  \
4   17.0          8         302.0       140.0    3449          10.5   
5   15.0          8         429.0       198.0    4341          10.0   
17  21.0          6         200.0        85.0    2587          16.0   
25  10.0          8         360.0       215.0    4615          14.0   
32  25.0          4          98.0         NaN    2046          19.0   

    model_year origin              name  
4           70    usa       ford torino  
5           70    usa  ford galaxie 500  
17          70    usa     ford maverick  
25          70    usa         ford f250  
32          71    usa        ford pinto  </code></pre>
</div>
</div>
</section>
<section id="or-1" class="level4">
<h4 class="anchored" data-anchor-id="or-1">OR</h4>
<div id="1a99a1cd" class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1"></a>filtered_rows <span class="op">=</span> mpg[grep(<span class="st">"ford"</span>, mpg[<span class="st">'name'</span>], values <span class="op">=</span> <span class="va">False</span>)]</span>
<span id="cb16-2"><a href="#cb16-2"></a><span class="bu">print</span>(filtered_rows.head())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     mpg  cylinders  displacement  horsepower  weight  acceleration  \
4   17.0          8         302.0       140.0    3449          10.5   
5   15.0          8         429.0       198.0    4341          10.0   
17  21.0          6         200.0        85.0    2587          16.0   
25  10.0          8         360.0       215.0    4615          14.0   
32  25.0          4          98.0         NaN    2046          19.0   

    model_year origin              name  
4           70    usa       ford torino  
5           70    usa  ford galaxie 500  
17          70    usa     ford maverick  
25          70    usa         ford f250  
32          71    usa        ford pinto  </code></pre>
</div>
</div>
<hr style="border: none; border-top: 2px solid #007bff; width: 100%; margin-top: 20px; margin-bottom: 20px;">
</section>
</section>
<section id="substituting-values-using-re.sub" class="level2">
<h2 class="anchored" data-anchor-id="substituting-values-using-re.sub">2. Substituting Values using re.sub()</h2>
<p>re.sub works like gsub to substitute values. For example, if we want to replace “usa” with “United States” in the ‘origin’ column:</p>
<div id="4b1c36c7" class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1"></a><span class="co"># Replace 'usa' with 'United States' in the 'origin' column</span></span>
<span id="cb18-2"><a href="#cb18-2"></a>mpg[<span class="st">'origin'</span>] <span class="op">=</span> mpg[<span class="st">'origin'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: re.sub(<span class="st">'usa'</span>, <span class="st">'United States'</span>, x))</span>
<span id="cb18-3"><a href="#cb18-3"></a><span class="bu">print</span>(mpg.head())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    mpg  cylinders  displacement  horsepower  weight  acceleration  \
0  18.0          8         307.0       130.0    3504          12.0   
1  15.0          8         350.0       165.0    3693          11.5   
2  18.0          8         318.0       150.0    3436          11.0   
3  16.0          8         304.0       150.0    3433          12.0   
4  17.0          8         302.0       140.0    3449          10.5   

   model_year         origin                       name  
0          70  United States  chevrolet chevelle malibu  
1          70  United States          buick skylark 320  
2          70  United States         plymouth satellite  
3          70  United States              amc rebel sst  
4          70  United States                ford torino  </code></pre>
</div>
</div>
<hr style="border: none; border-top: 2px solid #007bff; width: 100%; margin-top: 20px; margin-bottom: 20px;">
</section>
<section id="extracting-words-with-re.findall" class="level2">
<h2 class="anchored" data-anchor-id="extracting-words-with-re.findall">3. Extracting words with re.findall()</h2>
<p>If we want to extract all words starting with ‘chev’ from the name column and put them in another column, we can use <code>re.findall()</code>.</p>
<div id="2223a673" class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1"></a><span class="co"># Extract all words starting with 'chev' in the 'name' column</span></span>
<span id="cb20-2"><a href="#cb20-2"></a>mpg[<span class="st">"chev"</span>] <span class="op">=</span> mpg[<span class="st">"name"</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: re.findall(<span class="vs">r"\bchev\w*"</span>, x))</span>
<span id="cb20-3"><a href="#cb20-3"></a><span class="bu">print</span>(mpg[[<span class="st">"name"</span>, <span class="st">"chev"</span>]].head())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                        name                   chev
0  chevrolet chevelle malibu  [chevrolet, chevelle]
1          buick skylark 320                     []
2         plymouth satellite                     []
3              amc rebel sst                     []
4                ford torino                     []</code></pre>
</div>
</div>
<p><strong><span style="color: #002569; font-size: 30px; font-weight: bold;">How did we get ” </span><span style="color: #0074e0; font-size: 30px; font-weight: bold;">r</span><span style="color: red; font-size: 30px; font-weight: bold;">’\b</span><span style="color: purple; font-size: 30px; font-weight: bold;">chev</span><span style="color: darkgreen; font-size: 30px; font-weight: bold;">\w</span><span style="color: orange; font-size: 30px; font-weight: bold;"><em>*’</em></span><span style="color: #002569; font-size: 30px; font-weight: bold;"> ” ?</span></strong></p>
<p><span style="color: #0074e0; font-size:20px;font-weight: bold;">1. <strong>r - Raw String</strong> </span><br>
The r before the string indicates a raw string in Python. This tells Python not to treat backslashes () as escape characters.<br>
For example, in a regular string, represents a newline. In a raw string (r”“), it is treated literally as backslash followed by n. Without the r, the regex would need to be written as ’\bchev\w*’.</p>
<p><span style="color: red; font-size:20px;font-weight: bold;">2. <strong> Word Boundary</strong></span><br>
atches a word boundary, which is the position between a word character (letters, digits, or underscore: [a-zA-Z0-9_]) and a non-word character.<br>
It ensures the match starts at the beginning of a word.<br>
Examples:<br>
In “chevrolet”, matches because “chev” is at the beginning of the word.<br>
In “123chev”, does not match because “chev” is not preceded by a word boundary.<br>
In “superchev”, does not match because “chev” is in the middle of a word.</p>
<p><span style="color: purple; font-size:20px;font-weight: bold;">3. <strong>chev - Literal Characters</strong></span><br>
The sequence chev matches the literal string “chev”.<br>
This part ensures the regex is looking specifically for words that begin with “chev”.</p>
<p><span style="color: darkgreen; font-size:20px;font-weight: bold;">4. <strong>- Word Character</strong></span><br>
matches any word character, which includes:<br>
Letters (a-z, A-Z)<br>
Digits (0-9)<br>
Underscore (_)<br>
This ensures the regex continues matching after “chev” if there are valid word characters.</p>
<p><span style="color: orange; font-size:20px;font-weight: bold;">5. <strong>* - Zero or More</strong></span><br>
* is a quantifier that matches zero or more of the preceding character or group.<br>
In this case, means “match zero or more word characters after ‘chev’”. This allows the regex to match “chev” alone or “chevrolet”, “chevalier”, etc.</p>
<p>For more information on regular expression symbols, see <a href="https://www.pythoncheatsheet.org/cheatsheet/regular-expressions">the regular expressions cheatsheet</a>.</p>
<hr style="border: none; border-top: 1px solid #f8f9fa; max-width: 950px;">
<section id="we-can-also-use-expressions-like-this-in-our-grep-function" class="level3">
<h3 class="anchored" data-anchor-id="we-can-also-use-expressions-like-this-in-our-grep-function">We can also use expressions like this in our grep function</h3>
<p>If we want to get all names beginning with ‘chev’, we can…</p>
<div id="7c25ff42" class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1"></a>grep(<span class="vs">r'\bchev\w*'</span>, mpg[<span class="st">'name'</span>], values <span class="op">=</span> <span class="va">True</span>)[<span class="dv">1</span>:<span class="dv">10</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="12">
<pre><code>['chevrolet impala',
 'chevrolet monte carlo',
 'chevy c20',
 'chevrolet vega 2300',
 'chevrolet chevelle malibu',
 'chevrolet impala',
 'chevrolet vega (sw)',
 'chevrolet vega',
 'chevrolet impala']</code></pre>
</div>
</div>
<hr style="border: none; border-top: 2px solid #007bff; width: 100%; margin-top: 20px; margin-bottom: 20px;">
</section>
</section>
<section id="splitting-strings-with-re.split" class="level2">
<h2 class="anchored" data-anchor-id="splitting-strings-with-re.split">4. Splitting Strings with re.split()</h2>
<p>If we want to split the ‘name’ column into separate words, we can use <code>re.split()</code>.</p>
<div id="f33d772d" class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1"></a><span class="co"># Split 'name' into separate words</span></span>
<span id="cb24-2"><a href="#cb24-2"></a>mpg[<span class="st">'name_split'</span>] <span class="op">=</span> mpg[<span class="st">'name'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: re.split(<span class="vs">r'\s+'</span>, x))</span>
<span id="cb24-3"><a href="#cb24-3"></a><span class="bu">print</span>(mpg[[<span class="st">'name'</span>, <span class="st">'name_split'</span>]].head())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                        name                     name_split
0  chevrolet chevelle malibu  [chevrolet, chevelle, malibu]
1          buick skylark 320          [buick, skylark, 320]
2         plymouth satellite          [plymouth, satellite]
3              amc rebel sst              [amc, rebel, sst]
4                ford torino                 [ford, torino]</code></pre>
</div>
</div>
<hr style="border: none; border-top: 2px solid #007bff; width: 100%; margin-top: 20px; margin-bottom: 20px;">
</section>
<section id="add-optional-flags-to-ignore-case" class="level2">
<h2 class="anchored" data-anchor-id="add-optional-flags-to-ignore-case">5. Add Optional Flags To Ignore Case</h2>
<p>For case-insensitive matching (ignore.case = TRUE in R):</p>
<div id="754aa99c" class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1"></a>filtered_rows <span class="op">=</span> mpg[mpg[<span class="st">'name'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: <span class="bu">bool</span>(re.search(<span class="st">'FORD'</span>, x, re.IGNORECASE)))]</span>
<span id="cb26-2"><a href="#cb26-2"></a><span class="bu">print</span>(filtered_rows.head())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     mpg  cylinders  displacement  horsepower  weight  acceleration  \
4   17.0          8         302.0       140.0    3449          10.5   
5   15.0          8         429.0       198.0    4341          10.0   
17  21.0          6         200.0        85.0    2587          16.0   
25  10.0          8         360.0       215.0    4615          14.0   
32  25.0          4          98.0         NaN    2046          19.0   

    model_year         origin              name chev            name_split  
4           70  United States       ford torino   []        [ford, torino]  
5           70  United States  ford galaxie 500   []  [ford, galaxie, 500]  
17          70  United States     ford maverick   []      [ford, maverick]  
25          70  United States         ford f250   []          [ford, f250]  
32          71  United States        ford pinto   []         [ford, pinto]  </code></pre>
</div>
</div>
<section id="or-2" class="level4">
<h4 class="anchored" data-anchor-id="or-2">OR</h4>
<div id="bdca533b" class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1"></a>filtered_rows <span class="op">=</span> mpg[grep(<span class="st">'FORD'</span>, mpg[<span class="st">'name'</span>], ignore_case <span class="op">=</span> <span class="va">True</span>)]</span>
<span id="cb28-2"><a href="#cb28-2"></a><span class="bu">print</span>(filtered_rows.head())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     mpg  cylinders  displacement  horsepower  weight  acceleration  \
4   17.0          8         302.0       140.0    3449          10.5   
5   15.0          8         429.0       198.0    4341          10.0   
17  21.0          6         200.0        85.0    2587          16.0   
25  10.0          8         360.0       215.0    4615          14.0   
32  25.0          4          98.0         NaN    2046          19.0   

    model_year         origin              name chev            name_split  
4           70  United States       ford torino   []        [ford, torino]  
5           70  United States  ford galaxie 500   []  [ford, galaxie, 500]  
17          70  United States     ford maverick   []      [ford, maverick]  
25          70  United States         ford f250   []          [ford, f250]  
32          71  United States        ford pinto   []         [ford, pinto]  </code></pre>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
          // target, if specified
          link.setAttribute("target", "_blank");
          if (link.getAttribute("rel") === null) {
            link.setAttribute("rel", "noopener");
          }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>